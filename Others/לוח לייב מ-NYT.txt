<script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<body><div id="demo"></div></body>

<div dir="rtl" id="iowa-map" style="height:97vh;">

<style>
.results { width:250px; color:#000!important; font-size:12.5px; text-align:center; }
.results td { padding:5px; border-bottom:1px dashed #DDD;} .results th { padding:5px; }
.name { font-size:17.5px; text-decoration:underline; }
.headline { background-color:#EEE; color:#555 }

.sumup img { width:75%!important; border-radius:50%; border:solid 5px;}
.sumup .clinton { border-color:#64b5f6; }
.sumup .biden { border-color:#64b5f6; }
.sumup .sanders { border-color:#81d4fa; }
.sumup .buttigieg { border-color:#b2ebf2; }
.sumup .warren { border-color:#e0f2f1; }
</style>

<script src="//www.amcharts.com/lib/4/core.js"></script>
<script src="//www.amcharts.com/lib/4/maps.js"></script>
<script src="//www.amcharts.com/lib/4/geodata/region/usa/iaLow.js"></script>
<script src="//www.amcharts.com/lib/4/themes/animated.js"></script>

<script>
am4core.useTheme(am4themes_animated);

var chart = am4core.create("iowa-map", "MapChart");
chart.projection = new am4maps.projections.Mercator();
chart.geodata = am4geodata_region_usa_iaLow;
chart.seriesContainer.events.disableType("doublehit");
chart.seriesContainer.draggable = false;
chart.chartContainer.wheelable = false;

var map20 = chart.series.push(new am4maps.MapPolygonSeries());
map20.useGeodata = true;
map20.dataFields.vote1 = "vote1";
map20.dataFields.vote2 = "vote2";
map20.dataFields.winner = "cand0";
map20.tooltip.getFillFromObject = false;
map20.data = document.getElementById("demo").innerHTML;

map20.mapPolygons.template.states.create("hover").adapter.add("fill", (fill, target) => {return am4core.color(am4core.colors.lighten(fill.rgb, 0.25))});

map20.mapPolygons.template.tooltipHTML = `
<table class='results' border='0'>
<tr class='name'><th colspan='3'>מחוז {name}</th></tr>
<tr class='headline'><th width='60%'>שם</th><th width='20%'>קולות</td><th width='20%'>אחוזים</th></tr>
<tr><td>{cand0}</td><td>{vote0}</td><td></td></tr>
</table>`;

map20.mapPolygons.template.adapter.add("fill", function(fill, target) {
 if (target.dataItem.winner  == "trumpd") { return am4core.color("#333") }

});
</script>

<script>
var jsondata;
$.getJSON("//int.nyt.com/applications/elections/2020/data/api/2020-02-03/iowa/president/republican.json", function(json){
 jsondata = json;
});

var file = jsondata.data.races[0];
for (var i = 0; i <= 98; i++) {
  document.getElementById("demo").innerHTML += "[" 
 if (typeof file.counties[i] === 'undefined') {
  i = +i;
 } else {
  document.getElementById("demo").innerHTML += "{'id':" + file.counties[i].fips+ "," + "'state':'IA'" + "," + "'total':" + file.counties[i].votes + ",";
  var subfile = file.counties[i].results;
  keys = Object.keys(file.counties[i].results);
  for (var j = 0; j < Object.keys(file.counties[i].results).length; j++) {
   document.getElementById("demo").innerHTML += "'cand"+j + "':'" + keys[j] + "'," + "'vote"+j + "':" +subfile[keys[j]] + ",";
  }
  document.getElementById("demo").innerHTML += "}," 
 }
}
  document.getElementById("demo").innerHTML += "]" 
</script>